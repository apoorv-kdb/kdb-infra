@use '../../styles/variables' as *;

.ctrl-sidebar {
  position: relative;
  width: 256px;
  min-width: 256px;
  max-width: 256px;          // prevent any width expansion
  background: linear-gradient(180deg, #E8EEF7 0%, #EEF2F9 100%);
  border-right: 2px solid #C5D3E8;
  box-shadow: 2px 0 6px rgba(25, 118, 210, 0.08);
  display: flex;
  flex-direction: column;
  transition: width 0.2s ease, min-width 0.2s ease;
  overflow: visible;         // allow dropdown panels to escape sidebar bounds

  &--collapsed {
    width: 0;
    min-width: 0;
    max-width: 0;
    border-right: none;
    box-shadow: none;
  }

  // ---- Toggle tab ----
  &__toggle {
    position: absolute;
    top: 50%;
    right: -14px;
    transform: translateY(-50%);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--color-primary);
    color: white;
    border: 2px solid white;
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: $font-size-xs;
    cursor: pointer;
    z-index: 10;
    transition: background 0.15s;

    &:hover { background: var(--color-primary-dark); }
  }

  // ---- Content ----
  &__content {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow-y: auto;
    overflow-x: clip;    // clip instead of hidden â€” doesn't trap absolutely-positioned children
    padding: $space-sm;
    gap: 2px;
    width: 256px;        // explicit width prevents expansion

    &::-webkit-scrollbar { width: 4px; }
    &::-webkit-scrollbar-track { background: transparent; }
    &::-webkit-scrollbar-thumb { background: #C5D3E8; border-radius: 2px; }
  }

  // ---- Sections ----
  &__section {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: $space-xs 0;
  }

  &__section-label {
    font-size: $font-size-xs;
    font-weight: $font-weight-bold;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    padding: 2px $space-xs;
  }

  &__section-body {
    display: flex;
    flex-direction: column;
    gap: 4px;
    > * { width: 100%; }
  }

  &__row {
    display: flex;
    gap: $space-xs;
    > * { flex: 1; min-width: 0; }
    &--wrap { flex-wrap: wrap; }
  }

  &__spacer { flex: 1; }

  // ---- Presets ----
  &__preset-wrapper {
    position: relative;
    margin-bottom: $space-xs;
  }

  &__preset-btn {
    width: 100%;
    display: flex;
    align-items: center;
    gap: $space-sm;
    height: 34px;
    padding: 0 $space-sm;
    background: rgba(255,255,255,0.7);
    border: 1px solid #C5D3E8;
    border-radius: $border-radius-sm;
    font-size: $font-size-base;
    font-weight: $font-weight-medium;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: background 0.15s;
    &:hover { background: rgba(255,255,255,0.95); }
  }

  &__chevron {
    margin-left: auto;
    font-size: 9px;
    color: var(--color-text-muted);
  }

  &__preset-menu {
    position: absolute;
    bottom: calc(100% + 4px);
    left: 0;
    right: 0;
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border);
    border-radius: $border-radius-md;
    box-shadow: var(--shadow-lg);
    z-index: 200;
    overflow: hidden;
    padding: $space-xs 0;
    max-height: 300px;
    overflow-y: auto;
  }

  &__preset-empty {
    padding: $space-sm $space-md;
    color: var(--color-text-muted);
    font-size: $font-size-sm;
    text-align: center;
  }

  &__preset-group-label {
    padding: $space-xs $space-md 2px;
    font-size: $font-size-xs;
    font-weight: $font-weight-bold;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    background: var(--color-bg-elevated);
    border-top: 1px solid var(--color-border-light);
    &:first-child { border-top: none; }
  }

  &__preset-item {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 2px $space-xs 2px $space-sm;
    &:hover { background: var(--color-bg-elevated); }
  }

  &__preset-star {
    color: var(--color-text-muted);
    font-size: $font-size-sm;
    padding: 4px;
    flex-shrink: 0;
    transition: color 0.15s;
    &:hover { color: #FFB300; }
    &--active { color: #FFB300 !important; }
  }

  &__preset-name {
    flex: 1;
    padding: 5px 0;
    font-size: $font-size-base;
    color: var(--color-text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: $space-xs;
  }

  &__preset-badge {
    font-size: $font-size-xs;
    background: var(--color-primary-light);
    color: var(--color-primary-dark);
    padding: 1px 5px;
    border-radius: $border-radius-pill;
    font-weight: $font-weight-medium;
  }

  &__preset-delete {
    padding: 4px $space-xs;
    color: var(--color-text-muted);
    font-size: $font-size-xs;
    &:hover { color: var(--color-negative); }
  }

  &__preset-divider {
    height: 1px;
    background: var(--color-border-light);
    margin: $space-xs 0;
  }

  &__preset-save-action {
    display: flex;
    align-items: center;
    gap: $space-sm;
    padding: $space-xs $space-md;
    font-size: $font-size-base;
    color: var(--color-primary);
    cursor: pointer;
    &:hover { background: var(--color-primary-light); }
  }

  // ---- Apply button ----
  &__apply-btn {
    width: 100%;
    height: 36px;
    background: var(--color-primary);
    color: white;
    border-radius: $border-radius-sm;
    font-size: $font-size-base;
    font-weight: $font-weight-semibold;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: $space-sm;
    cursor: pointer;
    transition: background 0.15s;
    margin-bottom: $space-xs;
    &:hover { background: var(--color-primary-dark); }
  }
}
